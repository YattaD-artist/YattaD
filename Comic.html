<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YattaD - Truyện Tranh</title>
  <link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
* { box-sizing: border-box; }
html, body { max-width: 100%; overflow-x: hidden; }
body {
  margin: 0; font-family: 'Saira', sans-serif;
  background-color: var(--bg); color: var(--text);
  --bg: #ede9eb; --text: #1a2129; --accent: #e32630;
  transition: background-color 0.3s, color 0.3s;
}
body.dark { --bg: #1b1b1b; --text: #f5f5f5; --accent: #1cd9cf; }

header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 24px; border-bottom: 1px solid #ccc; background-color: var(--bg);
  position: sticky; top: 0; z-index: 100;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
}

.center-title { flex: 1; text-align: center; font-weight: 800; font-size: 2.5rem; color: var(--accent); }
.left, .right { display: flex; align-items: center; gap: 16px; }
.icon-btn {
  background: none; border: none; cursor: pointer; font-size: 1.3rem;
  color: var(--text); display: flex; align-items: center; justify-content: center;
  width: 38px; height: 38px; border-radius: 50%;
  transition: transform 0.25s ease, color 0.25s ease, background-color 0.25s ease;
  text-decoration: none;
}
.icon-btn:hover { transform: scale(1.15); color: var(--accent); background-color: rgba(0,0,0,0.05); }

main { display: flex; flex-direction: column; gap: 24px; padding: 30px; }

/* Intro */
.info {
  width: 100%; padding: 32px; background-color: var(--bg);
  border-radius: 12px; border: 1px solid rgba(0,0,0,0.1);
  box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
  transition: background-color 0.3s, box-shadow 0.3s, border-color 0.3s;
}
.info h2 { font-size: 2rem; margin-bottom: 16px; font-weight: 700; color: var(--accent);
  border-bottom: 3px solid var(--accent); display: inline-block; padding-bottom: 5px; }
.info p { margin-bottom: 12px; line-height: 1.6; }

/* Menu grid */
.menu {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 18px;
}
.menuItem {
  cursor: pointer;
  text-align: center;
  border: 2px solid var(--text);
  border-radius: 12px;
  padding: 8px;
  transition: transform 0.25s, box-shadow 0.25s;
}
.menuItem img {
  width: 100%;
  height: auto;
  border-radius: 8px;
  margin-bottom: 6px;
}
.menuItem:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  border-color: var(--accent);
}

/* --- Animation cho overlay reader --- */
#deck {
  position: relative;
  width: 100%;
  max-width: 1000px;
  height: 100%;
  display: block;
  margin: 0 auto;
  overflow: visible !important;
}

/* Overlay & deck: không cắt ảnh */
#overlay { padding: 16px; }

/* Ảnh luôn fit vào khung, không cắt nội dung */
#deck img {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  max-width: 100%;
  max-height: 90vh;
  object-fit: contain;
  cursor: pointer;
  transition: transform 0.52s cubic-bezier(.2,.8,.2,1), opacity 0.44s ease;
  will-change: transform, opacity;
  user-select: none;
}

/* map các class từ code mẫu sang styles "lá bài" */
.active {
  transform: translate(-50%, -50%) translateX(0) scale(1) rotate(0deg);
  z-index: 30;
  opacity: 1;
  max-width: 60vw;
  max-height: 90vh;
}
.left {
  transform: translate(-50%, -50%) translateX(-36vw) rotate(-15deg) scale(0.82);
  z-index: 20;
  opacity: 0.95;
  max-width: 18vw;
  max-height: 60vh;
}
.right {
  transform: translate(-50%, -50%) translateX(36vw) rotate(15deg) scale(0.82);
  z-index: 20;
  opacity: 0.95;
  max-width: 18vw;
  max-height: 60vh;
}

/* Ẩn ảnh nếu không có src */
.hidden {
  opacity: 0;
  pointer-events: none;
}

/* Mobile: giảm khoảng cách translate */
@media (max-width: 768px) {
  .left { transform: translate(-50%, -50%) translateX(-28vw) rotate(-12deg) scale(0.78); max-width: 24vw; }
  .right { transform: translate(-50%, -50%) translateX(28vw) rotate(12deg) scale(0.78); max-width: 24vw; }
  .active { max-width: 86vw; }
  main { padding: 10px; gap: 12px; }
  .info { padding: 16px; }
  .menu { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; }
}
  </style>
</head>
<body>
<header>
  <div class="left">
    <a href="index.html" class="icon-btn" title="Trang chủ"><i class="fas fa-home"></i></a>
  </div>
  <div class="center-title" id="title">YattaD</div>
  <div class="right">
    <button class="icon-btn" id="theme-toggle" title="Đổi chế độ"><i class="fas fa-adjust"></i></button>
    <button class="icon-btn" id="lang-toggle" title="Đổi ngôn ngữ"><i class="fa-solid fa-language"></i></button>
  </div>
</header>

<main>
  <div class="info">
    <h2 id="introTitle">Lời Nói Đầu</h2>
    <p id="introP1">Chào mừng bạn đến với trang đọc truyện tranh của tôi! Tại đây bạn có thể khám phá các bộ truyện độc đáo và hấp dẫn.</p>
    <p id="introP2">Mỗi câu chuyện đều được lựa chọn kỹ lưỡng, hy vọng bạn sẽ tìm thấy những khoảnh khắc thú vị và cảm xúc khi thưởng thức.</p>
  </div>

  <div class="menu">
    <div class="menuItem" data-folder="PunkgaMerch">
      <img src="comics/PunkgaMerch/00.webp" alt="PunkgaMerch">
      <p id="menu1Name">PunkgaMerch</p>
    </div>
    <div class="menuItem" data-folder="Red&Ruby">
      <img src="comics/Red&Ruby/00.webp" alt="Red và Ruby">
      <p id="menu2Name">Red và Ruby</p>
    </div>
    <div class="menuItem" data-folder="TieuTung">
      <img src="comics/TieuTung/00.webp" alt="Tiêu Tùng">
      <p id="menu3Name">Tiêu Tùng</p>
    </div>
    <div class="menuItem" data-folder="Siin">
      <img src="comics/Siin/00.webp" alt="Sao Băng Mùa Hạ">
      <p id="menu4Name">Sao Băng Mùa Hạ</p>
    </div>
    <div class="menuItem" data-folder="BreakthRough">
      <img src="comics/BreakthRough/00.webp" alt="Khai Phá">
      <p id="menu5Name">Khai Phá</p>
    </div>
    <div class="menuItem" data-folder="StillComeTrue">
      <img src="comics/StillComeTrue/00.webp" alt="Vẫn Đúng">
      <p id="menu6Name">Vẫn Đúng</p>
    </div>
    <div class="menuItem" data-folder="LeThan">
      <img src="comics/LeThan/00.webp" alt="Lê Thận">
      <p id="menu7Name">Lê Thận</p>
    </div>
    <div class="menuItem" data-folder="Raku">
      <img src="comics/Raku/00.webp" alt="Raku">
      <p id="menu8Name">Raku</p>
    </div>
  </div>
</main>

<!-- Overlay Reader -->
<div id="overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; z-index:9999; flex-direction:column;">
  <div id="deck" style="position:relative; width:min(96vw,1200px); height:min(92vh,1000px); overflow:visible; display:block; align-items:center; justify-content:center; gap:20px;"></div>
  <div id="caption" style="color:#fff; margin-top:12px; font-size:1.1rem; text-align:center;"></div>
  <button id="closeBtn" style="position:absolute; top:20px; right:20px; font-size:1.5rem; background:none; color:#fff; border:none; cursor:pointer;">✖</button>
  <button id="restartBtn" style="position:absolute; bottom:20px; right:20px; font-size:1rem; display:none; padding:6px 12px; cursor:pointer;">Restart</button>
</div>

<script>
// ==== giữ cấu hình trang giống trước ====
const storyPages = {
  "PunkgaMerch": 14,
  "Red&Ruby": 0,
  "BreakthRough": 11,
  "TieuTung": 8,
  "Siin": 5,
  "StillComeTrue": 0,
  "LeThan": 0,
  "Raku": 0
};

// Theme toggle
const themeBtn = document.getElementById("theme-toggle");
themeBtn.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
});
if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark");

// Language toggle (giữ nguyên)
const langBtn = document.getElementById("lang-toggle");
let currentLang = localStorage.getItem("lang") || "vi";

const translations = {
  vi: {
    title: "YattaD",
    introTitle: "Lời Nói Đầu",
    introP1: "Chào mừng bạn đến với trang đọc truyện tranh của tôi! Tại đây bạn có thể khám phá các bộ truyện độc đáo và hấp dẫn.",
    introP2: "Mỗi câu chuyện đều được lựa chọn kỹ lưỡng, hy vọng bạn sẽ tìm thấy những khoảnh khắc thú vị và cảm xúc khi thưởng thức.",
    menu1Name: "PunkgaMerch",
    menu2Name: "Red và Ruby",
    menu3Name: "Tiêu Tùng",
    menu4Name: "Sao Băng Mùa Hạ",
    menu5Name: "Khai Phá",
    menu6Name: "Vẫn Đúng",
    menu7Name: "Lê Thận",
    menu8Name: "Raku"
  },
  en: {
    title: "YattaD",
    introTitle: "Introduction",
    introP1: "Welcome to my comic reading page! Here you can explore unique and exciting stories.",
    introP2: "Each story is carefully selected, hope you will find interesting moments and emotions while enjoying.",
    menu1Name: "PunkgaMerch",
    menu2Name: "Red & Ruby",
    menu3Name: "Tieu Tung",
    menu4Name: "Summer Shooting Star",
    menu5Name: "Break thRough",
    menu6Name: "Still Come True",
    menu7Name: "Le Than",
    menu8Name: "Raku"
  }
};

function switchLanguage() {
  currentLang = currentLang === "vi" ? "en" : "vi";
  localStorage.setItem("lang", currentLang);

  for (const key in translations[currentLang]) {
    const el = document.getElementById(key);
    if (el) el.textContent = translations[currentLang][key];
  }
}
langBtn.addEventListener("click", switchLanguage);
document.addEventListener("DOMContentLoaded", () => {
  if (currentLang === "en") switchLanguage();
});

// ================= gallery theo mẫu bạn cho ================
(function setupGallery() {
  const deck = document.getElementById('deck');
  const overlay = document.getElementById('overlay');
  const caption = document.getElementById('caption');
  const closeBtn = document.getElementById('closeBtn');
  const restartBtn = document.getElementById('restartBtn');

  let images = [];      // image elements for current story
  let index = 0;
  let total = 0;
  let transitioning = false;
  let touchStartX = 0;
  let currentStory = "";

  // helper build src
  function buildSrc(folder, page) {
    return `comics/${folder}/${String(page).padStart(2, "0")}.webp`;
  }

  // tạo image elements cho một truyện, xóa deck cũ
  function prepareImages(folder) {
    // reset
    images = [];
    index = 0;
    currentStory = folder;
    total = storyPages[folder] || 1; // nếu 0 thì coi là 1 trang (bìa)

    // clear deck
    while (deck.firstChild) deck.removeChild(deck.firstChild);

    // tạo các <img>
    for (let i = 0; i < total; i++) {
      const img = document.createElement('img');
      img.draggable = false;
      img.src = buildSrc(folder, i);
      // lazy load nếu trang lớn
      if (i > 2) img.loading = 'lazy';

      // khi transition kết thúc, nếu element đang active thì tắt transitioning
      img.addEventListener('transitionend', (ev) => {
        // chỉ reset flag khi đang chuyển và phần tử vừa trở thành active (anima xong)
        if (ev.propertyName.includes('transform') && img.classList.contains('active')) {
          transitioning = false;
        }
      });

      deck.appendChild(img);
      images.push(img);
    }
  }

  // cập nhật class cho từng ảnh theo index
  function updateClasses() {
    images.forEach((img, i) => {
      img.classList.remove('left', 'active', 'right', 'hidden');
      img.style.zIndex = '';
      if (i < index - 6) { // quá xa bên trái -> ẩn để giảm DOM events
        img.classList.add('hidden');
      } else if (i > index + 6) { // quá xa bên phải -> ẩn
        img.classList.add('hidden');
      } else if (i < index) {
        img.classList.add('left');
        img.style.zIndex = String(10 + i);
      } else if (i === index) {
        img.classList.add('active');
        img.style.zIndex = '30';
      } else { // i > index
        img.classList.add('right');
        // đặt zIndex sao cho trang gần hơn có z-index cao hơn
        img.style.zIndex = String(20 - (i - index));
      }
    });

    caption.textContent = index === 0 ? 'Trang Bìa' : `Trang ${index}`;
    restartBtn.style.display = (index === total - 1) ? 'block' : 'none';
  }

  // mở overlay và chuẩn bị ảnh
  function openStory(folder) {
    prepareImages(folder);
    overlay.style.display = 'flex';
    // allow browser render, rồi set classes
    requestAnimationFrame(() => updateClasses());
  }

  // đóng overlay
  function closeStory() {
    overlay.style.display = 'none';
    transitioning = false;
  }

  // chuyển trang tiếp theo
  function next() {
    if (transitioning) return;
    if (index >= total - 1) return;
    transitioning = true;
    index++;
    updateClasses();
  }

  // chuyển trang trước
  function prev() {
    if (transitioning) return;
    if (index <= 0) return;
    transitioning = true;
    index--;
    updateClasses();
  }

  function restart() {
    if (transitioning) return;
    index = 0;
    updateClasses();
  }

  // gắn sự kiện cho menuItem: click sẽ mở truyện tương ứng
  document.querySelectorAll('.menuItem').forEach(item => {
    item.addEventListener('click', () => {
      const folder = item.dataset.folder;
      // nếu folder không hợp lệ, bỏ qua
      if (!folder) return;
      openStory(folder);
    });
  });

  // click overlay: click phải -> next, click trái -> prev, click giữa ít hơn margin không làm gì
  overlay.addEventListener('click', (e) => {
    // ignore clicks on control buttons
    const ignoreIds = ['closeBtn', 'restartBtn'];
    if (ignoreIds.includes(e.target.id)) return;

    // xác định điểm click so với overlay vùng
    const rect = overlay.getBoundingClientRect();
    // dùng rect trung tâm của màn hình, để tránh click trên các ảnh làm loạn
    const centerX = rect.left + rect.width / 2;
    const delta = e.clientX - centerX;
    const deadZone = 40; // vùng giữa không đổi
    if (delta > deadZone) next();
    else if (delta < -deadZone) prev();
  });

  // click trực tiếp lên deck images: nếu click vào left -> prev, active/ right -> next
  deck.addEventListener('click', (e) => {
    const t = e.target;
    if (!t || t.tagName !== 'IMG') return;
    if (t.classList.contains('left')) prev();
    else next(); // active hoặc right đều next
  });

  // touch swipe
  overlay.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
  }, {passive:true});
  overlay.addEventListener('touchend', (e) => {
    const diff = e.changedTouches[0].clientX - touchStartX;
    if (Math.abs(diff) > 50) diff < 0 ? next() : prev();
  });

  // keyboard
  window.addEventListener('keydown', (e) => {
    if (overlay.style.display !== 'flex') return;
    if (transitioning) return;
    if (e.key === 'ArrowRight') next();
    if (e.key === 'ArrowLeft') prev();
    if (e.key === 'Escape') closeStory();
    if (e.key.toLowerCase() === 'r') restart();
  });

  // buttons
  closeBtn.addEventListener('click', closeStory);
  restartBtn.addEventListener('click', restart);

  // expose open/close for console debugging if cần
  window.openStory = openStory;
  window.closeStory = closeStory;

})(); // end setupGallery
</script>

</body>
</html>
