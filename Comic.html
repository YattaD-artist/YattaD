<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YattaD - Truyện Tranh</title>
  <link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
* { box-sizing: border-box; }
html, body { max-width: 100%; overflow-x: hidden; }
body {
  margin: 0; font-family: 'Saira', sans-serif;
  background-color: var(--bg); color: var(--text);
  --bg: #ede9eb; --text: #1a2129; --accent: #e32630;
  transition: background-color 0.3s, color 0.3s;
}
body.dark { --bg: #1b1b1b; --text: #f5f5f5; --accent: #1cd9cf; }

header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 24px; border-bottom: 1px solid #ccc; background-color: var(--bg);
  position: sticky; top: 0; z-index: 100;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
}

.center-title { flex: 1; text-align: center; font-weight: 800; font-size: 2.5rem; color: var(--accent); }
.left, .right { display: flex; align-items: center; gap: 16px; }
.icon-btn {
  background: none; border: none; cursor: pointer; font-size: 1.3rem;
  color: var(--text); display: flex; align-items: center; justify-content: center;
  width: 38px; height: 38px; border-radius: 50%;
  transition: transform 0.25s ease, color 0.25s ease, background-color 0.25s ease;
  text-decoration: none;
}
.icon-btn:hover { transform: scale(1.15); color: var(--accent); background-color: rgba(0,0,0,0.05); }

main { display: flex; flex-direction: column; gap: 24px; padding: 30px; }

/* Intro */
.info {
  width: 100%; padding: 32px; background-color: var(--bg);
  border-radius: 12px; border: 1px solid rgba(0,0,0,0.1);
  box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
  transition: background-color 0.3s, box-shadow 0.3s, border-color 0.3s;
}
.info h2 { font-size: 2rem; margin-bottom: 16px; font-weight: 700; color: var(--accent);
  border-bottom: 3px solid var(--accent); display: inline-block; padding-bottom: 5px; }
.info p { margin-bottom: 12px; line-height: 1.6; }

/* Menu grid */
.menu {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 18px;
}
.menuItem {
  cursor: pointer;
  text-align: center;
  border: 2px solid var(--text);
  border-radius: 12px;
  padding: 8px;
  transition: transform 0.25s, box-shadow 0.25s;
}
.menuItem img {
  width: 100%;
  height: auto;
  border-radius: 8px;
  margin-bottom: 6px;
}
.menuItem:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  border-color: var(--accent);
}

/* --- Animation cho overlay reader --- */
#deck {
  position: relative;
  width: 100%;   /* full chiều ngang */
  max-width: 1000px; /* có thể giới hạn tối đa nếu muốn */
  height: 100%;  /* choáng hết overlay */
  display: block;
  align-items: center;
  justify-content: center;
  gap: 20px;
  overflow: visible !important;
}

/* Overlay & deck: không cắt ảnh */
#overlay { padding: 16px; }

/* Ảnh luôn fit vào khung, không cắt nội dung */
#deck img {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  max-width: 100%;
  max-height: 90vh;
  object-fit: contain;
  cursor: pointer;
  transition: transform 0.52s cubic-bezier(.2,.8,.2,1), opacity 0.44s ease;
  will-change: transform, opacity;
}

/* Kích thước và vị trí cho 3 trạng thái (lá bài) */
.curr-active { 
  /* chính giữa */
  transform: translate(-50%, -50%) translateX(0) scale(1) rotate(0deg);
  z-index: 3;
  opacity: 1;
  max-width: 60vw;
  max-height: 90vh;
}
.prev-side {
  /* thu nhỏ và nghiêng bên trái (vẫn hiện) */
  transform: translate(-50%, -50%) translateX(-36vw) rotate(-15deg) scale(0.82);
  z-index: 2;
  opacity: 0.95;
  max-width: 18vw;
  max-height: 60vh;
}
.next-side {
  /* thu nhỏ và nghiêng bên phải (vẫn hiện) */
  transform: translate(-50%, -50%) translateX(36vw) rotate(15deg) scale(0.82);
  z-index: 2;
  opacity: 0.95;
  max-width: 18vw;
  max-height: 60vh;
}

/* Ẩn ảnh nếu không có src (đỡ chiếm sự kiện click) */
.hidden-side {
  opacity: 0;
  pointer-events: none;
}

/* Mobile: giảm khoảng cách translate để còn vừa màn hình */
@media (max-width: 768px) {
  .prev-side { transform: translate(-50%, -50%) translateX(-28vw) rotate(-12deg) scale(0.78); max-width: 24vw; }
  .next-side { transform: translate(-50%, -50%) translateX(28vw) rotate(12deg) scale(0.78); max-width: 24vw; }
  .curr-active { max-width: 86vw; }
  main { padding: 10px; gap: 12px; }
  .info { padding: 16px; }
  .menu { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; }
}
  </style>
</head>
<body>
<header>
  <div class="left">
    <a href="index.html" class="icon-btn" title="Trang chủ"><i class="fas fa-home"></i></a>
  </div>
  <div class="center-title" id="title">YattaD</div>
  <div class="right">
    <button class="icon-btn" id="theme-toggle" title="Đổi chế độ"><i class="fas fa-adjust"></i></button>
    <button class="icon-btn" id="lang-toggle" title="Đổi ngôn ngữ"><i class="fa-solid fa-language"></i></button>
  </div>
</header>

<main>
  <div class="info">
    <h2 id="introTitle">Lời Nói Đầu</h2>
    <p id="introP1">Chào mừng bạn đến với trang đọc truyện tranh của tôi! Tại đây bạn có thể khám phá các bộ truyện độc đáo và hấp dẫn.</p>
    <p id="introP2">Mỗi câu chuyện đều được lựa chọn kỹ lưỡng, hy vọng bạn sẽ tìm thấy những khoảnh khắc thú vị và cảm xúc khi thưởng thức.</p>
  </div>

  <div class="menu">
    <div class="menuItem" data-folder="PunkgaMerch">
      <img src="comics/PunkgaMerch/00.webp" alt="PunkgaMerch">
      <p id="menu1Name">PunkgaMerch</p>
    </div>
    <div class="menuItem" data-folder="Red&Ruby">
      <img src="comics/Red&Ruby/00.webp" alt="Red và Ruby">
      <p id="menu2Name">Red và Ruby</p>
    </div>
    <div class="menuItem" data-folder="TieuTung">
      <img src="comics/TieuTung/00.webp" alt="Tiêu Tùng">
      <p id="menu3Name">Tiêu Tùng</p>
    </div>
    <div class="menuItem" data-folder="Siin">
      <img src="comics/Siin/00.webp" alt="Sao Băng Mùa Hạ">
      <p id="menu4Name">Sao Băng Mùa Hạ</p>
    </div>
    <div class="menuItem" data-folder="BreakthRough">
      <img src="comics/BreakthRough/00.webp" alt="Khai Phá">
      <p id="menu5Name">Khai Phá</p>
    </div>
    <div class="menuItem" data-folder="StillComeTrue">
      <img src="comics/StillComeTrue/00.webp" alt="Vẫn Đúng">
      <p id="menu6Name">Vẫn Đúng</p>
    </div>
    <div class="menuItem" data-folder="LeThan">
      <img src="comics/LeThan/00.webp" alt="Lê Thận">
      <p id="menu7Name">Lê Thận</p>
    </div>
    <div class="menuItem" data-folder="Raku">
      <img src="comics/Raku/00.webp" alt="Raku">
      <p id="menu8Name">Raku</p>
    </div>
  </div>
</main>

<!-- Overlay Reader -->
<div id="overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; z-index:9999; flex-direction:column;">
  <div id="deck" style="position:relative; width:min(96vw,1200px); height:min(92vh,1000px); overflow:visible; display:block; align-items:center; justify-content:center; gap:20px;"></div>
  <div id="caption" style="color:#fff; margin-top:12px; font-size:1.1rem; text-align:center;"></div>
  <button id="closeBtn" style="position:absolute; top:20px; right:20px; font-size:1.5rem; background:none; color:#fff; border:none; cursor:pointer;">✖</button>
  <button id="restartBtn" style="position:absolute; bottom:20px; right:20px; font-size:1rem; display:none; padding:6px 12px; cursor:pointer;">Restart</button>
</div>

<script>
// --- Config số trang mỗi truyện ---
const storyPages = {
  "PunkgaMerch": 14,
  "Red&Ruby": 0,
  "BreakthRough": 11,
  "TieuTung": 8,
  "Siin": 5,
  "StillComeTrue": 0,
  "LeThan": 0,
  "Raku": 0
};

// --- Preload ảnh trang 00 cho tất cả ---
function preloadFirstPages() {
  for (const folder in storyPages) {
    const img = new Image();
    img.src = `comics/${folder}/00.webp`;
  }
}
document.addEventListener("DOMContentLoaded", preloadFirstPages);

// --- Theme toggle ---
const themeBtn = document.getElementById("theme-toggle");
themeBtn.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
});
if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark");

// --- Language toggle ---
const langBtn = document.getElementById("lang-toggle");
let currentLang = localStorage.getItem("lang") || "vi";

const translations = {
  vi: {
    title: "YattaD",
    introTitle: "Lời Nói Đầu",
    introP1: "Chào mừng bạn đến với trang đọc truyện tranh của tôi! Tại đây bạn có thể khám phá các bộ truyện độc đáo và hấp dẫn.",
    introP2: "Mỗi câu chuyện đều được lựa chọn kỹ lưỡng, hy vọng bạn sẽ tìm thấy những khoảnh khắc thú vị và cảm xúc khi thưởng thức.",
    menu1Name: "PunkgaMerch",
    menu2Name: "Red và Ruby",
    menu3Name: "Tiêu Tùng",
    menu4Name: "Sao Băng Mùa Hạ",
    menu5Name: "Khai Phá",
    menu6Name: "Vẫn Đúng",
    menu7Name: "Lê Thận",
    menu8Name: "Raku"
  },
  en: {
    title: "YattaD",
    introTitle: "Introduction",
    introP1: "Welcome to my comic reading page! Here you can explore unique and exciting stories.",
    introP2: "Each story is carefully selected, hope you will find interesting moments and emotions while enjoying.",
    menu1Name: "PunkgaMerch",
    menu2Name: "Red & Ruby",
    menu3Name: "Tieu Tung",
    menu4Name: "Summer Shooting Star",
    menu5Name: "Break thRough",
    menu6Name: "Still Come True",
    menu7Name: "Le Than",
    menu8Name: "Raku"
  }
};

function switchLanguage() {
  currentLang = currentLang === "vi" ? "en" : "vi";
  localStorage.setItem("lang", currentLang);

  for (const key in translations[currentLang]) {
    const el = document.getElementById(key);
    if (el) el.textContent = translations[currentLang][key];
  }
}
langBtn.addEventListener("click", switchLanguage);
document.addEventListener("DOMContentLoaded", () => {
  if (currentLang === "en") switchLanguage();
});

// --- Overlay Reader ---
let currentStory = "";
let currentPage = 1;
let totalPages = 0;

const overlay = document.getElementById("overlay");
const deck = document.getElementById("deck");
const caption = document.getElementById("caption");
const closeBtn = document.getElementById("closeBtn");
const restartBtn = document.getElementById("restartBtn");

// tạo 3 ảnh (prev, curr, next) - có thể hoán đổi tham chiếu khi cần
let prevImg = document.createElement("img");
let currImg = document.createElement("img");
let nextImg = document.createElement("img");

// style cơ bản (các lớp CSS sẽ override transform)
[prevImg, currImg, nextImg].forEach(img => {
  img.style.position = "absolute";
  img.style.transition = "transform 0.52s cubic-bezier(.2,.8,.2,1), opacity 0.44s ease";
  img.style.objectFit = "contain";
  img.draggable = false;
});

// append vào deck (thứ tự không quan trọng vì z-index do class quyết định)
deck.appendChild(prevImg);
deck.appendChild(currImg);
deck.appendChild(nextImg);

// helper build src
function buildSrc(folder, page) {
  return `comics/${folder}/${String(page).padStart(2, "0")}.webp`;
}

// hiển thị trạng thái 3 ảnh theo currentPage
function showPageInitial() {
  const prevSrc = (currentPage > 1) ? buildSrc(currentStory, currentPage - 1) : "";
  const currSrc = buildSrc(currentStory, currentPage);
  const nextSrc = (currentPage < totalPages) ? buildSrc(currentStory, currentPage + 1) : "";

  // gán src
  if (prevSrc) { prevImg.src = prevSrc; prevImg.className = "prev-side"; prevImg.classList.remove("hidden-side"); }
  else { prevImg.removeAttribute("src"); prevImg.className = "prev-side hidden-side"; }

  currImg.src = currSrc;
  currImg.className = "curr-active";

  if (nextSrc) { nextImg.src = nextSrc; nextImg.className = "next-side"; nextImg.classList.remove("hidden-side"); }
  else { nextImg.removeAttribute("src"); nextImg.className = "next-side hidden-side"; }

  caption.innerText = `Trang ${currentPage} / ${totalPages}`;
  restartBtn.style.display = (currentPage === totalPages) ? "block" : "none";
}

// Khi mở truyện
function openStory(folder) {
  currentStory = folder;
  totalPages = storyPages[folder] || 1;
  currentPage = 1;
  overlay.style.display = "flex";
  showPageInitial();
}

// Hàm next với animation lá bài: curr -> prev (trượt trái), next -> curr (từ phải vào), tạo next mới
let animating = false;
function nextPage() {
  if (animating) return;
  if (currentPage >= totalPages) return;
  animating = true;
  const oldPrev = prevImg, oldCurr = currImg, oldNext = nextImg;

  // tăng trang trước để biết page mới
  currentPage++;

  // 1) set class để chạy animation:
  // curr trượt sang trái -> prev-side
  oldCurr.className = "prev-side";
  // next trượt vào giữa -> curr-active
  oldNext.className = "curr-active";

  // nếu không còn next sau trang mới thì newNext sẽ hidden
  const futureNextSrc = (currentPage < totalPages) ? buildSrc(currentStory, currentPage + 1) : "";

  // sau animation (khoảng thời gian bằng CSS transition), hoán đổi tham chiếu
  setTimeout(() => {
    // rotate references: prev <- oldCurr, curr <- oldNext, next <- oldPrev
    prevImg = oldCurr;
    currImg = oldNext;
    nextImg = oldPrev;

    // gán src cho nextImg (đặt ra phải, nhưng class sẽ là next-side)
    if (futureNextSrc) {
      nextImg.src = futureNextSrc;
      nextImg.className = "next-side";
      nextImg.classList.remove("hidden-side");
    } else {
      nextImg.removeAttribute("src");
      nextImg.className = "next-side hidden-side";
    }

    // prevImg should already show page currentPage -1 (oldCurr). Ensure src correctness:
    const prevSrc = (currentPage > 1) ? buildSrc(currentStory, currentPage - 1) : "";
    if (prevSrc) prevImg.src = prevSrc;
    else prevImg.removeAttribute("src");

    // currImg should be page currentPage
    currImg.src = buildSrc(currentStory, currentPage);

    caption.innerText = `Trang ${currentPage} / ${totalPages}`;
    restartBtn.style.display = (currentPage === totalPages) ? "block" : "none";
    animating = false;
  }, 540); // nhỏ hơn hoặc xấp xỉ duration CSS (0.52s)
}

// Hàm prev với animation ngược lại: curr -> next (trượt phải), prev -> curr (từ trái vào)
function prevPageFunc() {
  if (animating) return;
  if (currentPage <= 1) return;
  animating = true;
  const oldPrev = prevImg, oldCurr = currImg, oldNext = nextImg;

  currentPage--;

  // set classes để animate:
  oldCurr.className = "next-side"; // center trượt sang phải
  oldPrev.className = "curr-active"; // left trượt vào giữa

  const futurePrevSrc = (currentPage > 1) ? buildSrc(currentStory, currentPage - 1) : "";

  setTimeout(() => {
    // rotate references: next <- oldCurr, curr <- oldPrev, prev <- oldNext
    nextImg = oldCurr;
    currImg = oldPrev;
    prevImg = oldNext;

    // prevImg (new) should show page (currentPage -1) if exists, else hidden
    if (futurePrevSrc) {
      prevImg.src = futurePrevSrc;
      prevImg.className = "prev-side";
      prevImg.classList.remove("hidden-side");
    } else {
      prevImg.removeAttribute("src");
      prevImg.className = "prev-side hidden-side";
    }

    // currImg should be current page
    currImg.src = buildSrc(currentStory, currentPage);

    // nextImg should show page currentPage + 1 if exists
    const nextSrc = (currentPage < totalPages) ? buildSrc(currentStory, currentPage + 1) : "";
    if (nextSrc) {
      nextImg.src = nextSrc;
      nextImg.className = "next-side";
      nextImg.classList.remove("hidden-side");
    } else {
      nextImg.removeAttribute("src");
      nextImg.className = "next-side hidden-side";
    }

    caption.innerText = `Trang ${currentPage} / ${totalPages}`;
    restartBtn.style.display = (currentPage === totalPages) ? "block" : "none";
    animating = false;
  }, 540);
}

function restart() { currentPage = 1; showPageInitial(); }

// Events
closeBtn.addEventListener("click", () => overlay.style.display = "none");
restartBtn.addEventListener("click", restart);

document.querySelectorAll(".menuItem").forEach(item => {
  item.addEventListener("click", () => openStory(item.dataset.folder));
});

// Click xử lý: bấm vào ảnh giữa hoặc ảnh phải => next, bấm vào ảnh trái => prev
deck.addEventListener("click", e => {
  if (overlay.style.display !== "flex") return;
  const t = e.target;
  if (t === currImg) nextPage();
  else if (t === nextImg) nextPage();
  else if (t === prevImg) prevPageFunc();
});

// Keyboard
document.addEventListener("keydown", e => {
  if (overlay.style.display === "flex") {
    if (e.key === "ArrowRight") nextPage();
    if (e.key === "ArrowLeft") prevPageFunc();
    if (e.key === "Escape") overlay.style.display = "none";
    if (e.key.toLowerCase() === "r") restart();
  }
});

// Swipe detection
let touchStartX = 0;
let touchEndX = 0;

function handleGesture() {
  const diff = touchEndX - touchStartX;
  if (Math.abs(diff) > 50) {
    if (diff > 0) prevPageFunc();
    else nextPage();
  }
}

deck.addEventListener("touchstart", e => {
  touchStartX = e.changedTouches[0].screenX;
});

deck.addEventListener("touchend", e => {
  touchEndX = e.changedTouches[0].screenX;
  handleGesture();
});
</script>

</body>
</html>
